<!-- Sidebar -->
<div class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-sm transform -translate-x-full transition-transform duration-200 ease-in-out lg:translate-x-0 lg:static lg:inset-0" id="sidebar">
  <div class="flex items-center h-16 px-4 bg-white relative z-50">
    <%= link_to root_path, class: "flex items-center text-xl font-bold text-indigo-600 hover:text-indigo-700" do %>
      TaskManager
    <% end %>
    <button id="sidebar-close" class="ml-auto p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 lg:hidden">
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <nav class="mt-5 px-2 space-y-1">
    <!-- All Tasks -->
    <%= link_to tasks_path, 
        class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{'bg-indigo-100 text-indigo-900' if current_page?(tasks_path) && !params[:status].present?} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(tasks_path) && !params[:status].present?}" do %>
      My Tasks
      <span class="ml-auto bg-gray-200 text-gray-900 text-xs rounded-full px-2 py-1">
        <%= Current.user.tasks.count %>
      </span>
    <% end %>
    <!-- Pending Tasks -->
    <%= link_to pending_tasks_path, 
        class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{'bg-yellow-100 text-yellow-900' if current_page?(pending_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(pending_tasks_path)}" do %>
      Pending
      <span class="ml-auto bg-yellow-200 text-yellow-900 text-xs rounded-full px-2 py-1">
        <%= Current.user.tasks.pending.count %>
      </span>
    <% end %>
    <!-- In Progress Tasks -->
    <%= link_to in_progress_tasks_path, 
        class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{'bg-blue-100 text-blue-900' if current_page?(in_progress_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(in_progress_tasks_path)}" do %>
      In Progress
      <span class="ml-auto bg-blue-200 text-blue-900 text-xs rounded-full px-2 py-1">
        <%= Current.user.tasks.in_progress.count %>
      </span>
    <% end %>
    <!-- Completed Tasks -->
    <%= link_to completed_tasks_path, 
        class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{'bg-green-100 text-green-900' if current_page?(completed_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(completed_tasks_path)}" do %>
      Completed
      <span class="ml-auto bg-green-200 text-green-900 text-xs rounded-full px-2 py-1">
        <%= Current.user.tasks.completed.count %>
      </span>
    <% end %>
    <!-- Cancelled Tasks -->
    <%= link_to cancelled_tasks_path, 
        class: "group flex items-center px-2 py-2 text-sm font-medium rounded-md #{'bg-red-100 text-red-900' if current_page?(cancelled_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(cancelled_tasks_path)}" do %>
      Cancelled
      <span class="ml-auto bg-red-200 text-red-900 text-xs rounded-full px-2 py-1">
        <%= Current.user.tasks.cancelled.count %>
      </span>
    <% end %>
    <!-- Divider -->
    <div class="border-t border-gray-200 my-4"></div>
    <!-- Tags Section -->
    <div class="px-2 py-2">
      <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Tags</h3>
      <div class="mt-2 space-y-1">
        <% Tag.joins(:tasks).where(tasks: { user: Current.user }).distinct.limit(5).each do |tag| %>
          <%= link_to tasks_path(tag: tag.name), 
              class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900" do %>
            <span class="mr-3 h-2 w-2 bg-indigo-500 rounded-full"></span>
            <%= tag.name.capitalize %>
            <span class="ml-auto text-xs text-gray-500">
              <%= tag.tasks.where(user: Current.user).count %>
            </span>
          <% end %>
        <% end %>
        <% if Tag.joins(:tasks).where(tasks: { user: Current.user }).distinct.count > 5 %>
          <button class="group flex items-center px-2 py-1 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900 w-full text-left">
            <span class="mr-3 h-2 w-2 bg-gray-400 rounded-full"></span>
            View all tags
          </button>
        <% end %>
      </div>
    </div>
    <!-- Divider -->
    <div class="border-t border-gray-200 my-4"></div>
    <!-- Priority Section -->
    <div class="px-2 py-2">
      <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Priority</h3>
      <div class="mt-2 space-y-1">
        <!-- Low Priority -->
        <%= link_to low_priority_tasks_path, 
            class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md #{'bg-green-100 text-green-900' if current_page?(low_priority_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(low_priority_tasks_path)}" do %>
          <span class="mr-3 h-2 w-2 bg-green-500 rounded-full"></span>
          Low
          <span class="ml-auto text-xs text-gray-500">
            <%= Current.user.tasks.low.count %>
          </span>
        <% end %>
        <!-- Medium Priority -->
        <%= link_to medium_priority_tasks_path, 
            class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md #{'bg-yellow-100 text-yellow-900' if current_page?(medium_priority_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(medium_priority_tasks_path)}" do %>
          <span class="mr-3 h-2 w-2 bg-yellow-500 rounded-full"></span>
          Medium
          <span class="ml-auto text-xs text-gray-500">
            <%= Current.user.tasks.medium.count %>
          </span>
        <% end %>
        <!-- High Priority -->
        <%= link_to high_priority_tasks_path, 
            class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md #{'bg-orange-100 text-orange-900' if current_page?(high_priority_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(high_priority_tasks_path)}" do %>
          <span class="mr-3 h-2 w-2 bg-orange-500 rounded-full"></span>
          High
          <span class="ml-auto text-xs text-gray-500">
            <%= Current.user.tasks.high.count %>
          </span>
        <% end %>
        <!-- Urgent Priority -->
        <%= link_to urgent_priority_tasks_path, 
            class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md #{'bg-red-100 text-red-900' if current_page?(urgent_priority_tasks_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(urgent_priority_tasks_path)}" do %>
          <span class="mr-3 h-2 w-2 bg-red-500 rounded-full"></span>
          Urgent
          <span class="ml-auto text-xs text-gray-500">
            <%= Current.user.tasks.urgent.count %>
          </span>
        <% end %>
      </div>
    </div>
    <% if Current.user&.admin? %>
      <!-- Divider -->
      <div class="border-t border-gray-200 my-4"></div>
      <!-- Admin Section -->
      <div class="px-2 py-2">
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Admin</h3>
        <div class="mt-2 space-y-1">
          <%= link_to admin_path, 
              class: "group flex items-center px-2 py-1 text-sm font-medium rounded-md #{'bg-purple-100 text-purple-900' if current_page?(admin_path)} #{'text-gray-600 hover:bg-gray-50 hover:text-gray-900' unless current_page?(admin_path)}" do %>
            <svg class="mr-3 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
            </svg>
            Dashboard
          <% end %>
        </div>
      </div>
    <% end %>
  </nav>
</div>
<!-- Sidebar overlay for mobile -->
<div id="sidebar-overlay" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40 lg:hidden hidden"></div>
